<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catch the Fruits - Edwin Kibiwot</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1950&q=80') no-repeat center/cover;
    font-family: 'Montserrat', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    color: #fff;
  }

  /* Overlay for darkening background for contrast */
  body::before {
    content: '';
    position: fixed;
    top:0; left:0; right:0; bottom: 0;
    background: rgba(0, 50, 0, 0.4);
    pointer-events:none;
  }

  #game {
    position: relative;
    flex: 1;
    overflow: hidden;
    touch-action: none;
  }

  /* Basket */
  #basket {
    position: absolute;
    bottom: 15px;
    width: 120px;
    height: 80px;
    left: 50%;
    transform: translateX(-50%);
    cursor: pointer;
    z-index: 10;
  }

  /* Use SVG basket icon */
  #basket svg {
    width: 100%;
    height: 100%;
    filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.7));
  }

  /* Fruits */
  .fruit {
    position: absolute;
    width: 48px;
    height: 48px;
    background-repeat: no-repeat;
    background-size: contain;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
    z-index: 5;
  }
  .fruit.apple {
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/1/15/Red_Apple.jpg');
    border-radius: 50%;
  }
  .fruit.orange {
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/c/c4/Orange-Fruit-Pieces.jpg');
    border-radius: 50%;
  }
  .fruit.green {
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/f/fd/Green_Apple.jpg');
    border-radius: 50%;
  }

  /* Power-ups */
  .powerup {
    position: absolute;
    width: 36px;
    height: 36px;
    background-repeat: no-repeat;
    background-size: contain;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.7));
    z-index: 6;
  }
  .powerup.slow {
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/2/27/Blue_Diamond.svg'); /* Blue diamond as slow */
  }
  .powerup.double {
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/0/07/Double.svg'); /* A placeholder double points image */
    background-color: transparent;
  }

  /* Score and Level display */
  #hud {
    position: absolute;
    top: 10px;
    left: 15px;
    font-size: 22px;
    font-weight: 700;
    text-shadow: 1px 1px 3px black;
    z-index: 20;
  }
  #level {
    margin-left: 20px;
    font-weight: 600;
  }

  /* Controls */
  #controls {
    position: absolute;
    top: 10px;
    right: 15px;
    z-index: 20;
  }
  button {
    background: rgba(255, 255, 255, 0.8);
    border: none;
    margin-left: 10px;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s ease-in-out;
  }
  button:hover {
    background: rgba(255, 255, 255, 1);
  }

  /* Game message (game over / paused) */
  #message {
    position: absolute;
    z-index: 30;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.65);
    padding: 24px 40px;
    border-radius: 12px;
    font-size: 28px;
    text-align: center;
    display: none;
    user-select: none;
    line-height: 1.3;
    white-space: normal;
    cursor: pointer;
  }
  #message span {
    display: block;
    margin-top: 16px;
    font-size: 18px;
    font-weight: 400;
    color: #a3f7a3;
    cursor: pointer;
    text-decoration: underline;
  }

  /* Video overlay */
  #videoOverlay {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: rgba(0, 0, 0, 0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
  }
  #videoOverlay video {
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(255,255,255,0.6);
    cursor: pointer;
  }

  /* Footer */
  footer {
    background-color: rgba(30, 30, 30, 0.85);
    color: #eee;
    text-align: center;
    padding: 12px 0;
    font-size: 16px;
    font-weight: 600;
    box-shadow: inset 0 1px 5px rgba(255,255,255,0.1);
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 480px) {
    #basket {
      width: 90px;
      height: 60px;
    }
    .fruit {
      width: 36px;
      height: 36px;
    }
    #hud {
      font-size: 16px;
    }
    button {
      padding: 5px 10px;
      font-size: 14px;
    }
    #message {
      font-size: 20px;
      padding: 16px 30px;
    }
  }
</style>
</head>
<body>

<div id="game" aria-label="Catch the Falling Fruits Game" role="main" tabindex="0">
  <div id="hud">
    Score: <span id="score">0</span>
    <span id="level">Level: 1</span>
  </div>
  <div id="controls" aria-label="Game Controls">
    <button id="pauseBtn" aria-pressed="false" aria-label="Pause game">Pause</button>
    <button id="muteBtn" aria-pressed="false" aria-label="Mute background music">Mute Music</button>
  </div>
  <div id="basket" role="img" aria-label="Basket to catch fruits">
    <!-- SVG basket -->
    <svg viewBox="0 0 64 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path fill="#6F4E37" stroke="#3E2C1C" stroke-width="2" d="M4 40 Q 32 56 60 40 L 56 48 H 8z"/>
      <rect x="10" y="30" width="44" height="12" fill="#A0522D" rx="6" ry="6"/>
      <path fill="#3E2C1C" d="M14 30 L18 10 L46 10 L50 30z"/>
    </svg>
  </div>
  <div id="message" role="alert" aria-live="assertive"></div>
</div>

<footer>
  &copy; 2025 Edwin Kibiwot
</footer>

<!-- Video overlay -->
<div id="videoOverlay" role="region" aria-label="Game video overlay">
  <video id="gameVideo" muted>
    <source src="video1.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
</div>

<script>
  (() => {
    const game = document.getElementById('game');
    const basket = document.getElementById('basket');
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const message = document.getElementById('message');
    const pauseBtn = document.getElementById('pauseBtn');
    const muteBtn = document.getElementById('muteBtn');
    const videoOverlay = document.getElementById('videoOverlay');
    const gameVideo = document.getElementById('gameVideo');

    let gameWidth, gameHeight;
    function resizeGame() {
      gameWidth = game.clientWidth;
      gameHeight = game.clientHeight;
    }
    window.addEventListener('resize', resizeGame);
    resizeGame();

    // Basket control variables
    let basketX = gameWidth / 2;

    function moveBasket(x) {
      const halfWidth = basket.clientWidth / 2;
      basketX = Math.min(Math.max(x, halfWidth), gameWidth - halfWidth);
      basket.style.left = basketX + 'px';
    }

    // Track pointer movements (mouse/touch)
    function handlePointer(e) {
      if (isVideoPlaying || paused || gameOver) return;
      let clientX;
      if(e.touches) {
        clientX = e.touches[0].clientX;
      } else {
        clientX = e.clientX;
      }
      moveBasket(clientX);
    }
    game.addEventListener('mousemove', handlePointer);
    game.addEventListener('touchmove', handlePointer, {passive: true});

    // Game variables
    const fruitTypes = [
      {name: 'apple', url: 'https://upload.wikimedia.org/wikipedia/commons/1/15/Red_Apple.jpg'},
      {name: 'orange', url: 'https://upload.wikimedia.org/wikipedia/commons/c/c4/Orange-Fruit-Pieces.jpg'},
      {name: 'green', url: 'https://upload.wikimedia.org/wikipedia/commons/f/fd/Green_Apple.jpg'},
    ];

    const powerupTypes = [
      {name: 'slow', effect: 'slow', img: 'https://upload.wikimedia.org/wikipedia/commons/2/27/Blue_Diamond.svg'},
      {name: 'double', effect: 'double', img: 'https://upload.wikimedia.org/wikipedia/commons/6/64/Double_points_icon.svg'}
    ];

    let fruits = [];
    let powerups = [];
    let score = 0;
    let level = 1;
    let speed = 2;
    let spawnInterval = 1500; // initial spawn every 1.5s
    let maxSpeed = 8;
    let gameOver = false;
    let paused = false;
    let doublePointsActive = false;
    let doublePointsTimeout;
    let isVideoPlaying = false;

    // Sounds
    const sounds = {
      catch: new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg'),
      powerup: new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg'),
      gameover: new Audio('https://actions.google.com/sounds/v1/cartoon/boom.ogg'),
      bgMusic: new Audio('https://cdn.pixabay.com/download/audio/2021/09/11/audio_6be88aa721.mp3?filename=calm-background-music-8709.mp3')
    };
    sounds.bgMusic.loop = true;
    sounds.bgMusic.volume = 0.2;

    // Play or pause background music
    function toggleMusic() {
      if(sounds.bgMusic.paused) {
        sounds.bgMusic.play();
        muteBtn.textContent = 'Mute Music';
        muteBtn.setAttribute('aria-pressed', 'false');
      } else {
        sounds.bgMusic.pause();
        muteBtn.textContent = 'Play Music';
        muteBtn.setAttribute('aria-pressed', 'true');
      }
    }
    muteBtn.addEventListener('click', toggleMusic);

    // Power-up effects
    function activatePowerup(type) {
      sounds.powerup.play();
      if(type === 'slow') {
        speed = Math.max(1, speed / 2);
        setTimeout(() => {
          speed = Math.min(maxSpeed, speed * 2);
        }, 8000);
      } else if(type === 'double') {
        doublePointsActive = true;
        clearTimeout(doublePointsTimeout);
        doublePointsTimeout = setTimeout(() => {
          doublePointsActive = false;
        }, 8000);
      }
    }

    function createFruit() {
      if(gameOver || paused || isVideoPlaying) return;

      // 15% chance to spawn a powerup instead of fruit
      const spawnPowerup = Math.random() < 0.15;

      if(spawnPowerup) {
        const powerupType = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
        const powerup = document.createElement('div');
        powerup.classList.add('powerup', powerupType.name);
        powerup.style.backgroundImage = `url(${powerupType.img})`;
        powerup.x = Math.random() * (gameWidth - 36);
        powerup.y = -36;
        powerup.speed = speed * 0.6;
        powerup.effect = powerupType.effect;
        powerup.style.left = powerup.x + 'px';
        powerup.style.top = powerup.y + 'px';
        game.appendChild(powerup);
        powerups.push(powerup);
      } else {
        const fruitType = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
        const fruit = document.createElement('div');
        fruit.classList.add('fruit', fruitType.name);
        fruit.style.backgroundImage = `url(${fruitType.url})`;
        fruit.x = Math.random() * (gameWidth - 48);
        fruit.y = -48;
        fruit.speed = speed + Math.random();
        fruit.style.left = fruit.x + 'px';
        fruit.style.top = fruit.y + 'px';
        game.appendChild(fruit);
        fruits.push(fruit);
      }
    }

    function updateItems() {
      if(gameOver || paused || isVideoPlaying) return;

      for(let i = fruits.length -1; i >= 0; i--) {
        let fruit = fruits[i];
        fruit.y += fruit.speed;
        fruit.style.top = fruit.y + 'px';

        if(fruit.y + fruit.clientHeight >= gameHeight - basket.clientHeight - 20 &&
           fruit.x + fruit.clientWidth > basketX - basket.clientWidth/2 &&
           fruit.x < basketX + basket.clientWidth/2) {
          // Caught fruit
          let points = doublePointsActive ? 2 : 1;
          score += points;
          scoreEl.textContent = score;
          sounds.catch.play();
          fruit.remove();
          fruits.splice(i, 1);

          // Play video at score 10
          if(score >= 10 && !isVideoPlaying) {
            playVideo();
          }

          if(score > 0 && score % 15 === 0 && !isVideoPlaying) {
            level++;
            levelEl.textContent = level;
            speed = Math.min(maxSpeed, speed + 0.5);
            spawnInterval = Math.max(600, spawnInterval - 120);
            clearInterval(spawnTimer);
            spawnTimer = setInterval(createFruit, spawnInterval);
          }
        } else if(fruit.y > gameHeight) {
          // Missed fruit - game over
          endGame();
          break;
        }
      }

      // Move and check collision for powerups
      for(let i = powerups.length -1; i >= 0; i--) {
        let powerup = powerups[i];
        powerup.y += powerup.speed;
        powerup.style.top = powerup.y + 'px';

        if(powerup.y + powerup.clientHeight >= gameHeight - basket.clientHeight - 20 &&
           powerup.x + powerup.clientWidth > basketX - basket.clientWidth/2 &&
           powerup.x < basketX + basket.clientWidth/2) {
          activatePowerup(powerup.effect);
          powerup.remove();
          powerups.splice(i, 1);
        } else if(powerup.y > gameHeight) {
          powerup.remove();
          powerups.splice(i, 1);
        }
      }
    }

    // Video and game control
    function playVideo() {
      isVideoPlaying = true;
      videoOverlay.style.display = 'flex';

      // Pause spawning fruits and game loop
      clearInterval(spawnTimer);

      gameVideo.currentTime = 0;
      gameVideo.play();
    }

    gameVideo.addEventListener('ended', () => {
      stopVideo();
    });

    function stopVideo() {
      isVideoPlaying = false;
      videoOverlay.style.display = 'none';
      gameVideo.pause();
      gameVideo.currentTime = 0;
      if (!gameOver && !paused) {
        spawnTimer = setInterval(createFruit, spawnInterval);
        requestAnimationFrame(gameLoop);
      }
    }

    // Allow clicking video to skip
    gameVideo.addEventListener('click', stopVideo);

    function endGame() {
      gameOver = true;
      sounds.gameover.play();
      message.innerHTML = `Game Over! Final Score: <strong>${score}</strong><br><span id="restartBtn">Click here to Restart</span>`;
      message.style.display = 'block';
      pauseBtn.textContent = 'Pause';
      pauseBtn.setAttribute('aria-pressed', 'false');
      paused = false;
      clearInterval(spawnTimer);
      clearTimeout(doublePointsTimeout);
      doublePointsActive = false;
    }

    function restartGame() {
      score = 0;
      level = 1;
      speed = 2;
      spawnInterval = 1500;
      doublePointsActive = false;
      scoreEl.textContent = score;
      levelEl.textContent = level;
      message.style.display = 'none';
      gameOver = false;
      paused = false;
      isVideoPlaying = false;

      fruits.forEach(f => f.remove());
      fruits = [];
      powerups.forEach(p => p.remove());
      powerups = [];

      spawnTimer = setInterval(createFruit, spawnInterval);
      if(sounds.bgMusic.paused) sounds.bgMusic.play();
      requestAnimationFrame(gameLoop);
    }

    // Pause toggle
    function togglePause() {
      if(gameOver) return;
      paused = !paused;
      if(paused) {
        message.textContent = 'Paused';
        message.style.display = 'block';
        pauseBtn.textContent = 'Resume';
        pauseBtn.setAttribute('aria-pressed', 'true');
        clearInterval(spawnTimer);
      } else {
        message.style.display = 'none';
        pauseBtn.textContent = 'Pause';
        pauseBtn.setAttribute('aria-pressed', 'false');
        spawnTimer = setInterval(createFruit, spawnInterval);
        requestAnimationFrame(gameLoop);
      }
    }
    pauseBtn.addEventListener('click', togglePause);

    // Restart on click in message restart text
    message.addEventListener('click', e => {
      if(e.target && e.target.id === 'restartBtn') {
        restartGame();
      }
    });

    // Initial basket position in middle
    moveBasket(gameWidth / 2);

    // Game loop
    function gameLoop() {
      if(!gameOver && !paused && !isVideoPlaying) {
        updateItems();
        requestAnimationFrame(gameLoop);
      }
    }

    // Start game
    let spawnTimer = setInterval(createFruit, spawnInterval);
    sounds.bgMusic.play().catch(() => {
      // Auto-play may be restricted, user can unmute manually
    });
    requestAnimationFrame(gameLoop);

  })();
</script>

</body>
</html>
